<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fotografia de Sucesso - Heineken</title>
    <!-- Tailwind CSS via CDN para estilização rápida -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Estilos personalizados para garantir aparência de App Nativo */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f3f4f6;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Esconder scrollbar mas permitir rolagem */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Custom Scrollbar para lista de SKUs */
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        /* Animações suaves */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cores Heineken */
        .bg-heineken { background-color: #008200; }
        .text-heineken { color: #008200; }
        .border-heineken { border-color: #008200; }
        .focus-ring-heineken:focus { --tw-ring-color: #008200; }
    </style>
</head>
<body class="pb-32">

    <!-- Header Fixo -->
    <header class="bg-heineken text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-md mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <div class="bg-red-600 p-1.5 rounded-full shadow-sm border border-white/20 flex items-center justify-center w-6 h-6">
                         <span class="text-white text-xs font-bold">★</span>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold leading-none">Fotografia de Sucesso</h1>
                        <p class="text-[10px] opacity-80 font-medium tracking-wider mt-1">MIX COMPLETO</p>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-md mx-auto px-4 mt-6">
        
        <!-- Notificações -->
        <div id="notification" class="hidden mb-4 p-3 rounded-lg text-sm text-center font-medium shadow-sm border transition-all duration-300"></div>

        <!-- Input Card Principal -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden mb-6 border border-gray-100">
            <!-- Nome da Loja -->
            <div class="p-4 bg-gray-50 border-b border-gray-100">
                <label class="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-1.5">Ponto de Venda</label>
                <div class="relative">
                    <i data-lucide="store" class="absolute left-3 top-3 text-gray-400 w-4 h-4"></i>
                    <input
                        type="text"
                        id="storeName"
                        placeholder="Nome do Supermercado / Bar"
                        class="w-full pl-10 pr-4 py-2.5 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-600 focus:outline-none transition-all text-gray-800 placeholder-gray-400"
                    />
                </div>
            </div>

            <!-- Abas de Categoria -->
            <div class="flex border-b border-gray-200 bg-white sticky top-0 overflow-x-auto no-scrollbar" id="tabsContainer">
                <!-- Abas geradas via JS -->
            </div>

            <!-- Conteúdo da Aba Ativa -->
            <div class="p-5">
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <h3 id="categoryTitle" class="text-lg font-bold text-heineken transition-colors">Premium</h3>
                        <span id="categoryMeta" class="text-xs font-medium bg-gray-100 px-2 py-1 rounded-full text-gray-600 border border-gray-200">Meta: 57%</span>
                    </div>
                    
                    <!-- Lista de SKUs (Mix Completo) -->
                    <div class="mb-5">
                        <p class="text-[10px] text-gray-400 uppercase font-bold mb-2">Produtos desta Categoria:</p>
                        <div id="skuList" class="flex flex-wrap gap-1.5 max-h-32 overflow-y-auto pr-1 custom-scrollbar">
                            <!-- SKUs gerados via JS -->
                        </div>
                    </div>

                    <!-- Inputs de Medição -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Grupo Heineken (cm)</label>
                            <input
                                type="number"
                                inputmode="decimal"
                                id="inputHeineken"
                                placeholder="0"
                                class="w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:outline-none font-mono text-lg transition-all"
                            />
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Concorrência (cm)</label>
                            <input
                                type="number"
                                inputmode="decimal"
                                id="inputCompetitor"
                                placeholder="0"
                                class="w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-400 focus:outline-none font-mono text-lg transition-all"
                            />
                        </div>
                    </div>

                    <!-- Feedback Visual Instantâneo -->
                    <div id="instantFeedback" class="hidden mt-4 p-3 bg-gray-50 rounded-lg border border-gray-100 flex justify-between items-center fade-in">
                       <span class="text-xs text-gray-500 font-medium">Share Atual Calculado:</span>
                       <span id="calculatedShareDisplay" class="text-xl font-bold">0%</span>
                    </div>
                </div>
                
            </div>
        </div>

        <!-- Botões de Ação -->
        <div class="grid grid-cols-2 gap-3 mb-8">
            <button
                onclick="downloadCSV()"
                id="btnDownload"
                class="flex items-center justify-center gap-2 py-3 px-4 rounded-lg font-medium shadow-sm border text-sm transition-colors bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed"
                disabled
            >
                <i data-lucide="download" class="w-4 h-4"></i>
                Baixar Relatório
            </button>
            
            <button
                onclick="clearHistory()"
                id="btnClear"
                class="flex items-center justify-center gap-2 py-3 px-4 rounded-lg font-medium shadow-sm border text-sm transition-colors bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed"
                disabled
            >
                <i data-lucide="trash-2" class="w-4 h-4"></i>
                Limpar
            </button>
        </div>

        <!-- Lista de Histórico -->
        <div class="space-y-4">
            <div class="flex items-center justify-between px-1 mb-2">
                 <h3 class="text-gray-700 font-bold flex items-center gap-2 text-sm uppercase tracking-wide">
                   <i data-lucide="history" class="w-4 h-4"></i> Histórico Recente
                 </h3>
                 <span id="historyCount" class="text-xs bg-gray-200 text-gray-600 px-2 py-0.5 rounded-full">0</span>
            </div>

            <div id="historyList" class="space-y-4">
                <!-- Lista vazia -->
                <div class="text-center py-12 bg-white rounded-xl shadow-sm border border-dashed border-gray-300">
                    <i data-lucide="bar-chart-3" class="w-8 h-8 text-gray-300 mx-auto mb-2"></i>
                    <p class="text-gray-400 text-sm">Nenhuma medição registrada.</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Barra Fixa Inferior -->
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] z-40 px-4 py-3 safe-area-pb">
        <div class="max-w-md mx-auto">
            <!-- Resumo Global -->
            <div class="flex justify-between items-center mb-3 px-1">
                <span class="text-xs font-bold text-gray-500 uppercase tracking-wide">Share Loja Total</span>
                <div class="flex items-center gap-2">
                    <span id="globalTotalShare" class="text-2xl font-black text-gray-300">0%</span>
                </div>
            </div>
            
            <div class="flex gap-2">
                <button
                    onclick="handleSave()"
                    class="flex-1 bg-heineken hover:bg-green-800 text-white font-bold py-3 rounded-lg shadow-md active:scale-[0.98] transition-all flex items-center justify-center gap-2"
                >
                    <i data-lucide="save" class="w-5 h-5"></i>
                    Registrar Loja
                </button>
                 <button
                    onclick="resetDraft()"
                    class="px-3 bg-gray-100 hover:bg-gray-200 text-gray-500 rounded-lg transition-colors"
                    title="Limpar Rascunho"
                >
                    <i data-lucide="rotate-ccw" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURAÇÃO E DADOS ---
        const categoriesConfig = {
            premium: {
                key: 'premium',
                label: 'Premium',
                meta: 57,
                colorClass: 'text-heineken',
                dotColor: 'bg-heineken',
                focusRing: 'focus:ring-green-500',
                skus: ['Heineken Original (Lata/Long/600ml)', 'Heineken 0.0', 'Heineken Keg 5L', 'Sol Premium', 'Sol Mexicana']
            },
            craft: {
                key: 'craft',
                label: 'Craft (Artesanais)',
                meta: 53,
                colorClass: 'text-amber-600',
                dotColor: 'bg-amber-600',
                focusRing: 'focus:ring-amber-500',
                skus: ['Eisenbahn Pilsen', 'Eisenbahn Unfiltered', 'Eisenbahn IPA', 'Eisenbahn Pale Ale', 'Eisenbahn Session IPA', 'Eisenbahn Weizen', 'Baden Baden Cristal', 'Baden Baden Witbier', 'Baden Baden Golden', 'Baden Baden IPA', 'Lagunitas IPA', 'Blue Moon']
            },
            mainstream: {
                key: 'mainstream',
                label: 'Mainstream',
                meta: 25,
                colorClass: 'text-yellow-600',
                dotColor: 'bg-yellow-500',
                focusRing: 'focus:ring-yellow-400',
                skus: ['Amstel Lager', 'Amstel Ultra', 'Devassa Puro Malte', 'Tiger', 'Amstel Vibe/Spirit']
            },
            economy: {
                key: 'economy',
                label: 'Economy',
                meta: 15,
                colorClass: 'text-gray-600',
                dotColor: 'bg-gray-500',
                focusRing: 'focus:ring-gray-400',
                skus: ['Kaiser', 'Bavaria', 'Schin', 'Glacial', 'No Grau']
            }
        };

        // Estado Global
        let activeTab = 'premium';
        let measurements = {
            premium: { heineken: '', competitor: '' },
            craft: { heineken: '', competitor: '' },
            mainstream: { heineken: '', competitor: '' },
            economy: { heineken: '', competitor: '' }
        };
        let history = [];

        // --- INICIALIZAÇÃO ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            loadDraft(); // Carregar rascunho antes de renderizar
            renderTabs();
            renderCategoryContent();
            loadHistoryFromStorage();
            updateGlobalTotal(); // Atualizar total inicial
            
            // Listener global para o nome da loja
            document.getElementById('storeName').addEventListener('input', (e) => {
                saveDraft();
            });
        });

        // --- RENDERIZAÇÃO ---
        function renderTabs() {
            const container = document.getElementById('tabsContainer');
            container.innerHTML = '';
            
            Object.values(categoriesConfig).forEach(cat => {
                const isActive = activeTab === cat.key;
                const btn = document.createElement('button');
                btn.className = `flex-1 py-3 px-2 text-xs font-bold uppercase tracking-wide transition-colors border-b-2 whitespace-nowrap min-w-[80px] ${isActive ? 'border-heineken text-heineken bg-green-50/50' : 'border-transparent text-gray-400 hover:text-gray-600'}`;
                btn.textContent = cat.label.split(' ')[0];
                btn.onclick = () => switchTab(cat.key);
                container.appendChild(btn);
            });
        }

        function renderCategoryContent() {
            const config = categoriesConfig[activeTab];
            const data = measurements[activeTab];

            // Título e Meta
            const titleEl = document.getElementById('categoryTitle');
            titleEl.textContent = config.label;
            titleEl.className = `text-lg font-bold transition-colors ${config.colorClass}`;
            
            document.getElementById('categoryMeta').textContent = `Meta: ${config.meta}%`;

            // SKUs
            const skuList = document.getElementById('skuList');
            skuList.innerHTML = '';
            config.skus.forEach(sku => {
                const span = document.createElement('span');
                span.className = 'text-[10px] bg-gray-50 text-gray-600 px-2 py-1 rounded border border-gray-200 hover:border-gray-300 transition-colors cursor-default';
                span.textContent = sku;
                skuList.appendChild(span);
            });

            // Inputs
            const inputH = document.getElementById('inputHeineken');
            const inputC = document.getElementById('inputCompetitor');
            
            // Remover classes de foco antigas e adicionar novas
            inputH.className = inputH.className.replace(/focus:ring-\w+-\d+/g, config.focusRing);
            
            inputH.value = data.heineken;
            inputC.value = data.competitor;

            // Listeners para inputs
            inputH.oninput = (e) => updateMeasurement('heineken', e.target.value);
            inputC.oninput = (e) => updateMeasurement('competitor', e.target.value);

            updateFeedback();
        }

        function switchTab(key) {
            activeTab = key;
            renderTabs();
            renderCategoryContent();
        }

        function updateMeasurement(type, value) {
            measurements[activeTab][type] = value;
            saveDraft(); // Salvar a cada input
            updateFeedback();
            updateGlobalTotal();
        }

        function updateFeedback() {
            const h = parseFloat(measurements[activeTab].heineken) || 0;
            const c = parseFloat(measurements[activeTab].competitor) || 0;
            const total = h + c;
            
            const feedbackEl = document.getElementById('instantFeedback');
            const shareDisplay = document.getElementById('calculatedShareDisplay');

            if (h > 0 || c > 0) {
                feedbackEl.classList.remove('hidden');
                const share = total === 0 ? 0 : ((h / total) * 100).toFixed(1);
                const meta = categoriesConfig[activeTab].meta;
                
                shareDisplay.textContent = `${share}%`;
                shareDisplay.className = `text-xl font-bold ${parseFloat(share) >= meta ? 'text-green-600' : 'text-red-500'}`;
            } else {
                feedbackEl.classList.add('hidden');
            }
        }

        function updateGlobalTotal() {
            let totalHeineken = 0;
            let totalCompetitor = 0;

            Object.values(measurements).forEach(m => {
                totalHeineken += parseFloat(m.heineken) || 0;
                totalCompetitor += parseFloat(m.competitor) || 0;
            });

            const totalSpace = totalHeineken + totalCompetitor;
            const globalShare = totalSpace === 0 ? 0 : ((totalHeineken / totalSpace) * 100).toFixed(1);
            
            const el = document.getElementById('globalTotalShare');
            el.textContent = `${globalShare}%`;
            
            // Cor dinâmica baseada em uma "meta geral" fictícia ou apenas visual
            // Vamos usar 30% como base de "bom" para a loja toda, ou apenas cinza/verde
            if (totalSpace > 0) {
                el.className = `text-2xl font-black transition-colors ${parseFloat(globalShare) >= 30 ? 'text-heineken' : 'text-gray-800'}`;
            } else {
                el.className = 'text-2xl font-black text-gray-300';
            }
        }

        // --- LÓGICA DE NEGÓCIO ---

        function handleSave() {
            const storeName = document.getElementById('storeName').value.trim();

            if (!storeName) {
                showNotification('Por favor, insira o nome da loja.', 'error');
                return;
            }

            const hasData = Object.values(measurements).some(m => 
                (parseFloat(m.heineken) > 0 || parseFloat(m.competitor) > 0)
            );

            if (!hasData) {
                showNotification('Preencha os dados de pelo menos uma categoria.', 'error');
                return;
            }

            const report = {
                id: Date.now(),
                date: new Date().toLocaleDateString('pt-BR'),
                time: new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }),
                storeName: storeName,
                data: {},
                totalShare: 0
            };

            let totalHeinekenCm = 0;
            let totalCompetitorCm = 0;

            Object.keys(categoriesConfig).forEach(key => {
                const h = parseFloat(measurements[key].heineken) || 0;
                const c = parseFloat(measurements[key].competitor) || 0;
                const t = h + c;
                const share = t === 0 ? 0 : ((h / t) * 100).toFixed(1);

                report.data[key] = {
                    heinekenCm: h,
                    competitorCm: c,
                    share: share,
                    metaReached: parseFloat(share) >= categoriesConfig[key].meta
                };

                totalHeinekenCm += h;
                totalCompetitorCm += c;
            });

            const totalSpace = totalHeinekenCm + totalCompetitorCm;
            report.totalShare = totalSpace === 0 ? 0 : ((totalHeinekenCm / totalSpace) * 100).toFixed(1);

            history.unshift(report); // Adiciona no início
            saveHistoryToStorage();
            renderHistory();
            
            // Reset
            document.getElementById('storeName').value = '';
            Object.keys(measurements).forEach(k => measurements[k] = { heineken: '', competitor: '' });
            switchTab('premium'); // Volta para a primeira aba e limpa inputs visuais
            
            showNotification('Loja registrada com sucesso!', 'success');
            
            // Limpar rascunho após salvar com sucesso
            localStorage.removeItem('heineken_sos_draft');
            updateGlobalTotal();
        }

        // --- GESTÃO DE HISTÓRICO ---

        function renderHistory() {
            const list = document.getElementById('historyList');
            const count = document.getElementById('historyCount');
            const btnDown = document.getElementById('btnDownload');
            const btnClear = document.getElementById('btnClear');

            count.textContent = history.length;

            // Habilitar/Desabilitar botões
            if (history.length > 0) {
                btnDown.disabled = false;
                btnDown.className = btnDown.className.replace('bg-gray-100 text-gray-400 cursor-not-allowed', 'bg-white text-gray-700 hover:bg-gray-50 cursor-pointer');
                
                btnClear.disabled = false;
                btnClear.className = btnClear.className.replace('bg-gray-100 text-gray-400 cursor-not-allowed', 'bg-white text-red-600 hover:bg-red-50 cursor-pointer');
                
                list.innerHTML = '';
            } else {
                // Estado vazio
                btnDown.disabled = true;
                btnDown.className = 'flex items-center justify-center gap-2 py-3 px-4 rounded-lg font-medium shadow-sm border text-sm transition-colors bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed';
                
                btnClear.disabled = true;
                btnClear.className = 'flex items-center justify-center gap-2 py-3 px-4 rounded-lg font-medium shadow-sm border text-sm transition-colors bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed';
                
                list.innerHTML = `
                <div class="text-center py-12 bg-white rounded-xl shadow-sm border border-dashed border-gray-300">
                    <i data-lucide="bar-chart-3" class="w-8 h-8 text-gray-300 mx-auto mb-2"></i>
                    <p class="text-gray-400 text-sm">Nenhuma medição registrada.</p>
                </div>`;
                lucide.createIcons();
                return;
            }

            history.forEach(item => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden fade-in';
                
                // Header do Card
                let cardHTML = `
                <div class="bg-gray-50 px-4 py-3 border-b border-gray-100 flex justify-between items-center">
                    <div>
                        <h4 class="font-bold text-gray-800">${item.storeName}</h4>
                        <p class="text-[10px] text-gray-500">${item.date} às ${item.time}</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="text-right">
                           <span class="block text-[10px] text-gray-500 uppercase">Share Total</span>
                           <span class="font-bold text-gray-800">${item.totalShare}%</span>
                        </div>
                        <button onclick="deleteItem(${item.id})" class="text-gray-400 hover:text-red-500">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
                <div class="p-3 grid grid-cols-1 gap-2">`;

                // Linhas das Categorias
                Object.keys(categoriesConfig).forEach(key => {
                    const catData = item.data[key];
                    if (catData.heinekenCm == 0 && catData.competitorCm == 0) return;

                    const config = categoriesConfig[key];
                    const iconColor = catData.metaReached ? 'text-green-600' : 'text-red-500';
                    const icon = catData.metaReached ? 'check-circle-2' : 'alert-circle';

                    cardHTML += `
                    <div class="flex items-center justify-between text-sm py-1 border-b border-gray-50 last:border-0">
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 rounded-full ${config.dotColor}"></div>
                            <span class="text-gray-600 font-medium">${config.label.split(' ')[0]}</span>
                        </div>
                        <div class="flex items-center gap-3">
                           <span class="text-xs text-gray-400">Meta: ${config.meta}%</span>
                           <div class="flex items-center gap-1 font-bold ${iconColor}">
                             ${catData.share}%
                             <i data-lucide="${icon}" class="w-3.5 h-3.5"></i>
                           </div>
                        </div>
                    </div>`;
                });

                cardHTML += </div>;
                card.innerHTML = cardHTML;
                list.appendChild(card);
            });
            lucide.createIcons();
        }

        function deleteItem(id) {
            history = history.filter(item => item.id !== id);
            saveHistoryToStorage();
            renderHistory();
        }

        function clearHistory() {
            if (confirm('Limpar todo o histórico?')) {
                history = [];
                saveHistoryToStorage();
                renderHistory();
                showNotification('Histórico limpo.', 'success');
            }
        }

        // --- EXPORTAÇÃO ---
        function downloadCSV() {
            if (history.length === 0) return;

            let csvContent = "Data;Hora;Loja;Share Total (%);";
            Object.keys(categoriesConfig).forEach(key => {
                const label = categoriesConfig[key].label;
                csvContent += `${label} HEINEKEN (cm);${label} CONC (cm);${label} SHARE (%);Metas Batida?;;`;
            });
            csvContent += "\n";

            history.forEach(item => {
                let row = `${item.date};${item.time};${item.storeName};${item.totalShare.toString().replace('.', ',')};`;
                Object.keys(categoriesConfig).forEach(key => {
                    const catData = item.data[key];
                    row += `${catData.heinekenCm};${catData.competitorCm};${catData.share.toString().replace('.', ',')};${catData.metaReached ? 'SIM' : 'NAO'};`;
                });
                csvContent += row + "\n";
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `Fotografia_Sucesso_MixCompleto_${new Date().toLocaleDateString('pt-BR').replace(/\//g, '-')}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- UTILITÁRIOS ---
        function showNotification(msg, type) {
            const notif = document.getElementById('notification');
            notif.textContent = msg;
            notif.className = `mb-4 p-3 rounded-lg text-sm text-center font-medium shadow-sm border fade-in ${type === 'error' ? 'bg-red-100 text-red-700 border-red-200' : 'bg-green-100 text-green-700 border-green-200'}`;
            notif.classList.remove('hidden');
            setTimeout(() => {
                notif.classList.add('hidden');
            }, 3000);
        }

        function saveHistoryToStorage() {
            localStorage.setItem('heineken_sos_history', JSON.stringify(history));
        }

        function loadHistoryFromStorage() {
            const stored = localStorage.getItem('heineken_sos_history');
            if (stored) {
                try {
                    history = JSON.parse(stored);
                    renderHistory();
                } catch (e) {
                    console.error('Erro ao carregar histórico', e);
                }
            }
        }

        // --- RASCUNHO (DRAFT) ---
        function saveDraft() {
            const draft = {
                storeName: document.getElementById('storeName').value,
                measurements: measurements,
                timestamp: Date.now()
            };
            localStorage.setItem('heineken_sos_draft', JSON.stringify(draft));
        }

        function loadDraft() {
            const stored = localStorage.getItem('heineken_sos_draft');
            if (stored) {
                try {
                    const draft = JSON.parse(stored);
                    // Validar se não é muito antigo (opcional, aqui vamos manter sempre)
                    document.getElementById('storeName').value = draft.storeName || '';
                    if (draft.measurements) {
                        measurements = draft.measurements;
                    }
                    showNotification('Rascunho restaurado.', 'success');
                } catch (e) {
                    console.error('Erro ao carregar rascunho', e);
                }
            }
        }

        function resetDraft() {
            if(confirm('Deseja limpar os dados atuais do formulário?')) {
                document.getElementById('storeName').value = '';
                Object.keys(measurements).forEach(k => measurements[k] = { heineken: '', competitor: '' });
                localStorage.removeItem('heineken_sos_draft');
                switchTab('premium');
                updateGlobalTotal();
                showNotification('Formulário limpo.', 'success');
            }
        }
    </script>
</body>
</html>
